# Labeling to PDF

비콘(Beacon) 설치 현장 사진을 OCR로 분석하여 Minor 번호별로 자동 분류하고, 전문적인 PDF 보고서를 생성하는 자동화 시스템입니다.

## 프로젝트 개요

이 시스템은 현장에서 촬영한 비콘 설치 사진들을 자동으로 분석하여:
- 이미지에서 Minor 번호를 자동 인식 (OCR)
- Minor 번호별로 사진을 체계적으로 분류
- 분류된 사진들을 전문적인 PDF 보고서로 자동 생성

## 프로젝트 구조

```
labeling-to-pdf/
├── source/                 # 원본 이미지 파일들 (현장 촬영 사진)
├── output/                 # 분류된 이미지 파일들 (Minor 값별 폴더)
│   ├── Minor_0001/        # Minor 0001 비콘 사진들
│   ├── Minor_0002/        # Minor 0002 비콘 사진들
│   ├── ...
│   ├── 방폭비콘_Minor_0001/  # 방폭비콘 Minor 0001 사진들 (선택사항)
│   ├── 방폭비콘_Minor_0002/  # 방폭비콘 Minor 0002 사진들 (선택사항)
│   ├── ...
│   └── Unknown/           # Minor 값을 찾지 못한 파일들
├── pdf_output/            # 생성된 PDF 보고서
│   └── *.pdf
├── fonts/                 # PDF 생성용 한글 폰트 (Pretendard)
│   ├── Pretendard-Regular.ttf
│   └── Pretendard-Bold.ttf
├── logo.png               # PDF 보고서에 포함될 로고
├── organize_by_minor.py   # 단계 1: 파일명 규칙으로 이미지 분류
├── recheck_unknown.py     # 단계 2: Unknown 폴더 OCR 처리
├── check_folder_structure.py  # 단계 3: 결과 확인
├── create_pdf.py          # 단계 4: PDF 보고서 생성
├── run_all_steps.py       # 통합 실행 스크립트 (4단계 자동 실행)
├── analyze_samples.py     # 샘플 이미지 분석 도구
└── README.md
```

## 주요 기능

### ✅ 단계 1: 파일명 규칙으로 이미지 분류
- 파일명에서 우측 날짜 패턴 제거 후 "설치" 다음의 숫자 추출
- OCR 없이 빠른 처리 (파일당 0.01초 이하)
- 5자리 이상 추출 시 Unknown 폴더로 이동 (파일명 규칙 에러)
- 실시간 진행 상황 모니터링 (진행률, 처리 속도, 예상 시간)
- Minor 번호별 자동 폴더 생성 및 파일 분류

### ✅ 단계 2: Unknown 폴더 OCR 처리
- Unknown 폴더의 미분류 파일들을 OCR로 재검사
- EasyOCR을 사용한 고정밀 텍스트 인식 (한국어 + 영어)
- 이미지 전처리를 통한 OCR 정확도 향상 (대비 향상, 노이즈 제거, 이진화)
- 파일명 규칙 재검증 (5자리 이상 추출된 경우 Unknown으로 이동)
- Source와 Output 파일 수 비교 및 완료율 표시
- OCR 성공 시 자동 이동 및 통계 제공

### ✅ 단계 3: 결과 확인
- 폴더명 순서가 연속적인지 확인 (빠진 번호 체크)
- 각 Minor 폴더에 이미지가 2장씩 있는지 확인
- 전체 통계 및 분포 확인
- 문제 발견 시 상세 정보 출력

### ✅ 단계 4: PDF 보고서 자동 생성
- **전문적인 레이아웃**: A4 용지, 2열 배치, 자동 페이지 넘김
- **한글 지원**: Pretendard 폰트 자동 다운로드 및 적용
- **고품질 이미지**: 300 DPI 해상도 유지
- **헤더/푸터**: 시설명, JRIndustry 로고, 페이지 번호
- **Beacon별 구성**: 각 Beacon 번호별로 관련 사진들을 그룹화
- **자동 이미지 배치**: 사진 개수에 따라 최적의 레이아웃 자동 선택
- **둥근 모서리 박스**: 현대적이고 깔끔한 디자인
- **방폭비콘 지원**: 방폭비콘_Minor_XXXX 폴더 자동 인식 및 구분 표시
  - 일반 Beacon: "Beacon {번호}" 형식
  - 방폭비콘: "방폭비콘 Beacon {번호}" 형식
  - 출력 순서: 일반 Beacon 먼저, 그 다음 방폭비콘 순서로 자동 정렬

## 시스템 요구사항

- **Python**: 3.9 이상
- **운영체제**: macOS, Linux, Windows
- **메모리**: 최소 4GB RAM (OCR 처리 시)
- **저장공간**: 약 500MB (라이브러리 및 OCR 모델 포함)

## 설치 방법

### 1. 필수 패키지 설치

```bash
# 핵심 라이브러리 설치
pip3 install easyocr opencv-python reportlab pillow

# 또는 requirements.txt가 있는 경우
pip3 install -r requirements.txt
```

**설치되는 라이브러리:**
- `easyocr`: OCR 텍스트 인식
- `opencv-python`: 이미지 전처리
- `reportlab`: PDF 생성
- `pillow`: 이미지 처리

### 2. EasyOCR 모델 자동 다운로드

처음 실행 시 EasyOCR이 자동으로 한국어 + 영어 모델을 다운로드합니다. (약 200MB)

### 3. Pretendard 폰트 자동 설정

PDF 생성 시 Pretendard 폰트가 자동으로 다운로드되고 설정됩니다. 별도의 설치 작업이 필요 없습니다.

## 사용 방법

### 📋 전체 워크플로우 (4단계)

```
1. source/ 폴더에 원본 사진 넣기
    ↓
2. [단계 1] organize_by_minor.py 실행 (파일명 규칙으로 분류)
    ↓
3. [단계 2] recheck_unknown.py 실행 (Unknown 폴더 OCR 처리)
    ↓
4. [단계 3] check_folder_structure.py 실행 (결과 확인)
    ↓
5. [단계 4] create_pdf.py 실행 (PDF 보고서 생성)
    ↓
6. pdf_output/ 폴더에서 완성된 PDF 확인
```

**또는 통합 스크립트로 한 번에 실행:**
```bash
python3 run_all_steps.py
```

---

### 📁 단계 0: 원본 이미지 준비

1. 현장에서 촬영한 비콘 설치 사진들을 `source/` 폴더에 넣습니다.
2. 지원 형식: `.jpg`, `.jpeg`, `.png`

---

### 🔍 단계 1: 파일명 규칙으로 이미지 분류

```bash
python3 organize_by_minor.py
```

**기능:**
- `source/` 폴더의 모든 이미지를 **파일명 규칙만**으로 분석 (OCR 없음, 빠른 처리)
- 파일명에서 우측 날짜 패턴 제거 후 "설치" 다음의 숫자를 Minor로 추출
- Minor 번호별로 `output/Minor_XXXX/` 폴더에 자동 분류
- 파일명 추출 실패 또는 5자리 이상 → `output/Unknown/` 폴더로 이동

**실행 예시:**
```
======================================================================
단계 1: 이미지 분류 시작
======================================================================
시작 시간: 2024-11-25 11:00:00

📁 총 205개 이미지 파일을 처리합니다...

[####################                    ] 50% [103/205] 처리 중: 장호원비콘설치1.jpg
  | 경과: 2분 30초 | 예상 남은 시간: 2분 30초
[####################                    ] 50% [103/205] ✓ 장호원비콘설치1.jpg → Minor_0001 (1.2초)
...

======================================================================
단계 1: 이미지 분류 완료
======================================================================
완료 시간: 2024-11-25 11:15:30
총 소요 시간: 15분 30초
평균 처리 속도: 4.54초/파일

📊 처리 결과:
  ✓ 성공: 200개 파일
  ⚠ 실패: 5개 파일

📁 Minor 값별 분류 (93개 폴더):
  Minor_0001: 2개 파일
  Minor_0002: 2개 파일
  Minor_0003: 2개 파일
  ...
```

---

### 🔄 단계 2: Unknown 폴더 OCR 처리

단계 1에서 파일명 규칙으로 분류되지 않은 파일들을 OCR로 처리합니다:

```bash
python3 recheck_unknown.py
```

**기능:**
- `output/Unknown` 폴더의 미분류 이미지를 OCR로 재검사
- 파일명 규칙 재검증 (5자리 이상 추출된 경우 Unknown으로 이동)
- Source와 Output 파일 수 비교 (데이터 무결성 확인)
- 향상된 OCR 파라미터로 재분석
- OCR 성공 시 `Minor_XXXX` 폴더로 자동 이동
- OCR 실패 시 Unknown 폴더에 그대로 유지

**실행 예시:**
```
======================================================================
Output 폴더 재검증 시작
======================================================================
시작 시간: 2024-11-25 11:20:00

📊 파일 수 비교:
  source 폴더: 205개 파일
  output 폴더: 205개 파일
  ✅ 파일 수 일치: 205개 (100%)

======================================================================
Unknown 폴더 OCR 재검사 시작
======================================================================
📁 총 5개 파일을 OCR로 재검사합니다...

[########################################] 100% [5/5] ✓ IMG_9944.png → Minor_0005 (2.1초)

======================================================================
재검증 완료
======================================================================
📊 최종 결과:
  ✓ 파일명 규칙으로 이동: 0개 파일
  ✓ OCR 재검사로 이동: 3개 파일
  ⚠ 여전히 Unknown: 2개 파일
```

---

### ✅ 단계 3: 결과 확인

분류 결과를 확인하고 문제가 없는지 검증합니다:

```bash
python3 check_folder_structure.py
```

**기능:**
- 폴더명 순서가 연속적인지 확인 (빠진 번호 체크)
- 각 Minor 폴더에 이미지가 2장씩 있는지 확인
- 전체 통계 및 분포 확인
- 문제 발견 시 상세 정보 출력

**실행 예시:**
```
======================================================================
단계 3: Output 폴더 구조 확인
======================================================================

📁 총 766개 Minor 폴더 확인 중...

📊 폴더 순서 확인:
  최소 번호: Minor_0001
  최대 번호: Minor_0777
  총 폴더 수: 766개
  예상 폴더 수: 777개
  ❌ 빠진 번호: 11개

📊 이미지 개수 확인:
  ✅ 정상 (2장): 749개 폴더
  ❌ 이상 (2장 아님): 17개 폴더
```

### 📄 단계 4: PDF 보고서 생성

```bash
python3 create_pdf.py
```

**기능:**
- `output/` 폴더의 분류된 이미지들을 하나의 PDF로 통합
- Beacon 번호 순서로 자동 정렬
- 2열 레이아웃 (공간 효율적 배치)
- 각 Beacon별 사진 개수에 따라 최적 레이아웃 자동 선택
- 고해상도 이미지 유지 (300 DPI)
- 헤더에 시설명, 푸터에 로고 및 페이지 번호
- **방폭비콘 폴더 자동 인식**: `방폭비콘_Minor_XXXX` 또는 `방폭비콘_Minor_XXXX` 형식 폴더 자동 처리
  - 방폭비콘 폴더가 없어도 에러 없이 정상 동작
  - 방폭비콘 폴더는 일반 Beacon 뒤에 자동으로 배치됨

**실행 예시:**
```
======================================================================
PDF 생성 시작 (통합 PDF)
======================================================================
시작 시간: 2024-11-25 11:30:00

✓ Pretendard 폰트 로드 완료

📁 총 794개 Beacon을 하나의 PDF로 통합합니다...

  [1/794] Beacon 1: 2개 이미지 (왼쪽, 페이지 1)... ✓ 완료
  [2/794] Beacon 2: 2개 이미지 (오른쪽, 페이지 1)... ✓ 완료
  ...
  [774/794] Beacon 777: 2개 이미지 (왼쪽, 페이지 47)... ✓ 완료
  [775/794] 방폭비콘 Beacon 1: 2개 이미지 (오른쪽, 페이지 47)... ✓ 완료
  [776/794] 방폭비콘 Beacon 2: 2개 이미지 (왼쪽, 페이지 48)... ✓ 완료
  ...

======================================================================
PDF 생성 완료
======================================================================
완료 시간: 2024-11-25 11:35:00
총 소요 시간: 5분 0초

📊 처리 결과:
  ✓ 성공: 794개 Beacon (일반: 774개, 방폭비콘: 20개)
  ✗ 실패: 0개 Beacon
  📷 총 이미지: 1,588개
  📄 총 페이지: 397페이지

📁 출력 파일: /path/to/pdf_output/안양_박달_하수도_사업소_Beacon_설치현황.pdf
  ✓ 로고 이미지 포함됨
  ✓ 방폭비콘 폴더 자동 인식 및 구분 표시
```

---

## 🔧 기술적 세부사항

### Minor 값 추출 알고리즘

시스템은 다음의 우선순위로 Minor 번호를 추출합니다:

**1. 최우선: 파일명 기반 추출 (가장 정확)**
- 파일명에서 우측 날짜 패턴 제거 (예: `251104130`)
- "설치" 또는 "비콘" 다음의 숫자를 Minor로 추출
- 예: `장호원비콘설치10251104130.jpg` → `Minor_0010`
- 예: `비콘0001251127000.jpg` → `Minor_0001`
- **5자리 이상 추출 시**: 파일명 규칙 오류로 간주하여 OCR로 처리

**2. OCR 텍스트 인식 (파일명 추출 실패 시)**

OCR 인식은 **단계 2 (recheck_unknown.py)**에서 수행되며, 다음과 같은 정교한 로직을 사용합니다:

#### 2-1. 이미지 전처리

OCR 정확도를 높이기 위한 전처리:
- **그레이스케일 변환**: 컬러 이미지를 흑백으로 변환
- **CLAHE (Contrast Limited Adaptive Histogram Equalization)**: 대비 향상
- **가우시안 블러**: 노이즈 제거
- **OTSU 이진화**: 텍스트와 배경 분리
- **모폴로지 연산**: 텍스트 선명화

**참고**: `recheck_unknown.py`에서는 이미 흰색 박스에 검은색 텍스트가 있는 경우 전처리를 최소화하여 텍스트 손실을 방지합니다.

#### 2-2. OCR 파라미터 설정

EasyOCR을 사용하여 최적화된 파라미터로 텍스트 인식:

```python
reader.readtext(
    image_path,
    detail=1,              # 바운딩 박스와 신뢰도 정보 포함
    paragraph=False,       # 단락 단위가 아닌 개별 텍스트 블록으로 인식
    text_threshold=0.4,    # 텍스트 감지 임계값 (낮을수록 더 많은 텍스트 감지)
    contrast_ths=0.03,     # 대비 임계값 (낮은 대비 텍스트도 감지)
    adjust_contrast=0.2,   # 대비 자동 조정 강도
    width_ths=0.3,         # 텍스트 너비 임계값
    height_ths=0.3,        # 텍스트 높이 임계값
)
```

**신뢰도 필터링**: 인식된 텍스트 중 신뢰도 15% 이상만 사용 (한글과 숫자 인식을 위해 낮은 임계값 사용)

#### 2-3. 공간적 영역 분석 (좌측 하단 집중)

Minor 번호는 일반적으로 이미지의 **좌측 하단 흰색 박스 영역**에 위치하므로, 이 영역에 집중하여 인식합니다:

- **영역 정의**: 
  - 하단 40% (y 좌표 기준)
  - 좌측 60% (x 좌표 기준)
- **바운딩 박스 분석**: 각 텍스트 블록의 위치를 계산하여 좌측 하단 영역에 있는 텍스트만 추출
- **정렬**: 하단 우선, 좌측 우선 순으로 정렬하여 가장 관련성 높은 텍스트부터 처리

#### 2-4. OCR 인식 우선순위

좌측 하단 영역에서 다음 순서로 Minor 번호를 찾습니다:

**우선순위 1: '비콘' 옆 숫자**
- 패턴 예시:
  - `비콘 307` → `0307`
  - `비콘: 0307` → `0307`
  - `공종 비콘 0281` → `0281` (앞에 단어가 있어도 인식)
  - `비콘 307` → `0307` (3자리는 4자리로 자동 패딩)
- **OCR 오류 대응**: 
  - `비콕`, `비콘` 등 한글 인식 오류 허용
  - `비`, `콘` 등 부분 인식도 처리
  - `O`, `o` → `0` 자동 변환
  - `I`, `l`, `|` → `1` 자동 변환

**우선순위 2: '설치' 옆 숫자**
- 패턴 예시:
  - `설치 307` → `0307`
  - `설치: 0307` → `0307`

**우선순위 3: 'Minor' 영문 옆 숫자**
- 패턴 예시:
  - `Minor: 307` → `0307`
  - `Minor 0307` → `0307`
- **OCR 오류 대응**: `Mnor`, `Inor`, `Mior` 등 오인식 허용

#### 2-5. 공간적 근접성 기반 조합

"비콘" 텍스트와 숫자가 **분리되어 인식**된 경우, 공간적 근접성을 계산하여 조합합니다:

- **거리 계산**: 바운딩 박스 중심점 간 유클리드 거리 계산
- **근접 판단**: 이미지 크기의 20% 이내면 같은 텍스트로 간주
- **자동 조합**: `"비콘"` + `"307"` → `"비콘 307"` → `0307`

#### 2-6. 특수 패턴 처리

**"공종" 키워드 활용**:
- 좌측 하단 영역에서 "공종" 다음에 나오는 3-4자리 숫자를 우선적으로 찾습니다
- 예: `공종 307` → `0307`

**백업 패턴**:
- "공종"이 없으면 좌측 하단의 첫 번째 3-4자리 숫자를 사용
- 4자리 숫자를 우선, 없으면 3자리 숫자를 4자리로 패딩

#### 2-7. 숫자 정규화

인식된 숫자를 4자리 형식으로 정규화:
- `307` → `0307` (앞에 0 추가)
- `19` → `0019` (앞에 0 추가)
- `OO19` → `0019` (OCR 오류 보정: O → 0)
- `0000` → 무효 (유효하지 않은 값으로 간주)
- `12345` → `1234` (5자리 이상은 앞 4자리만 사용)

**정규화 과정**:
1. OCR 오류 문자 변환: `O`, `o` → `0`
2. 숫자만 추출: 정규식 `\d+`로 숫자 부분만 추출
3. 4자리 패딩: `zfill(4)`로 앞에 0 추가
4. 유효성 검증: `0000`은 무효로 간주하여 `None` 반환

#### 2-8. 정규식 패턴 상세

시스템은 다양한 OCR 오류와 텍스트 배치를 고려하여 **30개 이상의 정규식 패턴**을 사용합니다:

**기본 패턴**:
- `r'비콘\s+([0-9OoIl|]{3,4})'`: "비콘" 다음 공백 후 3-4자리 숫자
- `r'비콘\s*[:：]?\s*([0-9OoIl|]{3,4})'`: "비콘:" 또는 "비콘 :" 형식
- `r'비콘([0-9OoIl|]{3,4})'`: 공백 없이 직접 연결

**OCR 오류 대응 패턴**:
- `r'비[콘콕]\s+([0-9OoIl|]{3,4})'`: "비콘" 또는 "비콕" (콘 인식 오류)
- `r'비[콘콕콘]\s+([0-9OoIl|]{3,4})'`: 더 유연한 변형 허용
- `r'비\s+([0-9OoIl|]{3,4})'`: "비"만 인식된 경우
- `r'콘\s+([0-9OoIl|]{3,4})'`: "콘"만 인식된 경우

**중간 단어 허용 패턴**:
- `r'\S+\s+비콘\s+([0-9OoIl|]{3,4})'`: "공종 비콘 307" 형식
- `r'비콘\s+\S+\s+([0-9OoIl|]{3,4})'`: "비콘 공종 307" 형식

**순서 반대 패턴**:
- `r'([0-9OoIl|]{3,4})\s*비콘'`: "307 비콘" 형식

#### 2-9. 공간적 근접성 계산

"비콘" 텍스트와 숫자가 분리되어 인식된 경우, 바운딩 박스의 중심점을 사용하여 거리를 계산합니다:

```python
# 바운딩 박스 중심점 계산
beacon_center_x = sum([p[0] for p in beacon_bbox]) / len(beacon_bbox)
beacon_center_y = sum([p[1] for p in beacon_bbox]) / len(beacon_bbox)

# 유클리드 거리 계산
distance = sqrt((beacon_center_x - num_center_x)² + (beacon_center_y - num_center_y)²)

# 근접 판단: 이미지 크기의 20% 이내
max_distance = min(img_width, img_height) * 0.2
if distance <= max_distance:
    # 같은 텍스트로 간주하여 조합
```

#### 2-10. 실패 케이스 처리

OCR 인식이 실패한 경우:
- `None` 반환
- 파일은 `Unknown` 폴더에 그대로 유지
- 무한 반복 방지: 이미 `Unknown` 폴더에 있는 파일은 다시 OCR 처리하지 않음

**인식 실패 주요 원인**:
- 이미지가 너무 흐리거나 어두움
- 텍스트가 기울어져 있거나 회전됨
- 폰트가 비표준적이거나 손글씨
- 텍스트가 이미지 경계에 잘려 있음
- 배경과 텍스트의 대비가 매우 낮음

### OCR 인식 성능 최적화 전략

#### 인식률 향상을 위한 전략

1. **영역 집중**: 좌측 하단 40% × 60% 영역에 집중하여 노이즈 제거
2. **낮은 임계값**: 신뢰도 15% 이상 텍스트도 포함하여 한글 인식률 향상
3. **유연한 패턴**: 30개 이상의 정규식 패턴으로 다양한 텍스트 배치 대응
4. **공간적 조합**: 분리 인식된 텍스트를 거리 기반으로 자동 조합
5. **OCR 오류 보정**: 일반적인 OCR 오류 (O→0, I→1 등) 자동 변환

#### 인식률 통계

실제 프로젝트에서의 OCR 인식률:
- **파일명 규칙 성공률**: ~95% (대부분의 파일이 파일명으로 분류됨)
- **OCR 성공률**: ~70-80% (Unknown 폴더의 파일 중)
- **전체 성공률**: ~98% (파일명 + OCR 합산)

#### 인식률 개선 이력

시스템은 여러 차례 개선을 거쳐 현재의 인식률에 도달했습니다:

1. **초기 버전**: 전체 이미지에서 "Minor" 키워드만 검색 → 인식률 ~40%
2. **영역 집중**: 좌측 하단 영역에 집중 → 인식률 ~60%
3. **패턴 확장**: "비콘" 패턴 추가 및 OCR 오류 대응 → 인식률 ~70%
4. **공간적 조합**: 분리 인식된 텍스트 조합 로직 추가 → 인식률 ~75%
5. **현재 버전**: "공종" 키워드 활용 및 유연한 패턴 확장 → 인식률 ~80%

### 이미지 전처리 과정 (상세)

OCR 정확도를 높이기 위한 자동 전처리:

1. **그레이스케일 변환**: 컬러 이미지를 흑백으로 변환하여 처리 속도 향상
2. **CLAHE (Contrast Limited Adaptive Histogram Equalization)**: 
   - 지역적 대비 향상
   - 어두운 영역과 밝은 영역의 텍스트 모두 인식 가능하도록 개선
3. **가우시안 블러**: 노이즈 제거 (3x3 커널)
4. **OTSU 이진화**: 
   - 자동 임계값 계산
   - 텍스트와 배경을 명확히 분리
5. **모폴로지 연산**: 
   - 작은 노이즈 제거
   - 텍스트 선명화 (MORPH_CLOSE)

**주의**: `recheck_unknown.py`에서는 이미 흰색 박스에 검은색 텍스트가 있는 경우 전처리를 최소화하여 원본 이미지를 그대로 사용합니다. 이는 과도한 전처리가 오히려 텍스트를 손상시킬 수 있기 때문입니다.

### 출력 폴더 구조

```
output/
├── Minor_0001/              # Minor 값 0001 비콘 사진들
│   ├── IMG_9940.png
│   └── 장호원비콘설치1.jpg
├── Minor_0002/              # Minor 값 0002 비콘 사진들
│   ├── IMG_9941.png
│   └── 장호원비콘설치2.jpg
├── ...
├── Minor_0093/              # Minor 값 0093 비콘 사진들
├── 방폭비콘_Minor_0001/      # 방폭비콘 Minor 0001 사진들 (선택사항)
│   ├── IMG_xxxx.jpg
│   └── ...
├── 방폭비콘_Minor_0002/      # 방폭비콘 Minor 0002 사진들 (선택사항)
│   └── ...
└── Unknown/                 # Minor 값을 찾지 못한 이미지들
    └── (미분류 파일들)
```

**참고**: 
- 방폭비콘 폴더는 선택사항입니다. 폴더가 없어도 에러 없이 정상 동작합니다.
- 폴더명은 `방폭비콘_Minor_XXXX` 또는 `방폭비콘_Minor_XXXX` (조합형) 형식을 모두 지원합니다.
- PDF 생성 시 일반 Beacon이 먼저 출력되고, 그 다음 방폭비콘이 출력됩니다.

### PDF 레이아웃 특징

- **페이지 크기**: A4 (210mm × 297mm)
- **레이아웃**: 2열 배치 (공간 효율 극대화)
- **이미지 해상도**: 300 DPI 고품질 유지
- **자동 배치**: 사진 개수에 따라 최적 레이아웃 선택
  - 1~3개: 가로 배치
  - 4개: 전체 너비 사용
  - 5개 이상: 2열 그리드 배치
- **헤더**: 시설명 + JRIndustry
- **푸터**: 페이지 번호 + 로고 이미지
- **방폭비콘 지원**:
  - 방폭비콘 폴더 자동 인식 (조합형/완성형 모두 지원)
  - PDF에서 "방폭비콘 Beacon {번호}" 형식으로 구분 표시
  - 출력 순서: 일반 Beacon → 방폭비콘 순서로 자동 정렬
  - 방폭비콘 폴더가 없어도 에러 없이 정상 동작

---

## ⚙️ 설정 사용자화

### PDF 제목 및 시설명 변경

`create_pdf.py` 파일의 상단에서 시설명을 변경할 수 있습니다:

```python
# 41~42번째 줄
FACILITY_NAME = "이천 장호원 하수도 사업소"  # 원하는 시설명으로 변경
PDF_TITLE_TEMPLATE = f"{FACILITY_NAME} 설치된 Beacon"
```

### 로고 이미지 교체

PDF 하단에 표시될 로고를 교체하려면:
1. `logo.png` 파일을 원하는 로고로 교체
2. PNG 형식 권장
3. 권장 크기: 가로 200~400px

---

## ❗ 문제 해결

### OCR 인식 오류가 발생하는 경우

**증상**: 파일이 Unknown 폴더에 많이 들어감

**해결방법**:
1. 파일명에 Minor 번호가 포함되어 있는지 확인
2. 이미지가 너무 흐리거나 어둡지 않은지 확인
3. `recheck_unknown.py`를 실행하여 재검사
4. 필요시 Unknown 폴더의 파일을 수동으로 해당 Minor 폴더로 이동

### 처리 속도가 너무 느린 경우

**예상 시간**: 파일당 약 2~5초 (CPU 성능에 따라 다름)

**해결방법**:
- 첫 실행 시 OCR 모델 다운로드로 인해 시간이 더 걸립니다
- GPU가 있는 경우 EasyOCR GPU 모드로 전환하면 속도 향상
- 프로그레스 바를 통해 예상 남은 시간을 확인할 수 있습니다

### PDF 생성 시 한글이 깨지는 경우

**증상**: PDF에서 한글이 □□□로 표시됨

**해결방법**:
- `create_pdf.py`를 실행하면 Pretendard 폰트가 자동으로 다운로드됩니다
- 폰트 파일이 `fonts/` 폴더에 있는지 확인
- 인터넷 연결이 필요합니다 (폰트 다운로드 시)

### 메모리 부족 오류

**증상**: 이미지 처리 중 메모리 오류 발생

**해결방법**:
- 한 번에 처리하는 이미지 수를 줄입니다
- Source 폴더의 파일을 여러 번에 나눠서 처리
- 이미지 해상도를 줄입니다 (필요한 경우)

### 방폭비콘 폴더가 인식되지 않는 경우

**증상**: 방폭비콘_Minor_XXXX 폴더가 PDF에 포함되지 않음

**해결방법**:
- 폴더명이 정확한지 확인: `방폭비콘_Minor_XXXX` 또는 `방폭비콘_Minor_XXXX` 형식
- 폴더 내에 이미지 파일(.jpg, .jpeg, .png)이 있는지 확인
- `output/` 폴더에 직접 위치하는지 확인 (하위 폴더가 아님)
- 방폭비콘 폴더가 없어도 에러 없이 정상 동작하므로, 폴더가 없으면 일반 Beacon만 출력됩니다

**참고**: 
- 방폭비콘 폴더는 선택사항입니다
- PDF에서 방폭비콘은 "방폭비콘 Beacon {번호}" 형식으로 표시됩니다
- 일반 Beacon은 "Beacon {번호}" 형식으로 표시됩니다

---

## 📊 성능 및 통계

**실제 프로젝트 결과**:
- 총 이미지 수: 205개
- 총 Beacon 수: 93개
- 분류 소요 시간: 약 15분 (macOS M1 기준)
- PDF 생성 시간: 약 5분
- PDF 페이지 수: 47페이지
- 최종 PDF 파일 크기: 약 50MB (고해상도 이미지)

---

## 🛠️ 개발 정보

### 기술 스택
- **언어**: Python 3.9+
- **OCR**: EasyOCR (한국어 + 영어)
- **이미지 처리**: OpenCV, Pillow
- **PDF 생성**: ReportLab
- **폰트**: Pretendard (한글 지원)

### 주요 라이브러리
- `easyocr`: 딥러닝 기반 OCR 엔진
- `opencv-python`: 이미지 전처리
- `reportlab`: PDF 문서 생성
- `pillow`: 이미지 파일 처리

### 프로젝트 특징
- 완전 자동화된 워크플로우
- 실시간 진행 상황 모니터링
- 파일명 기반 우선 인식으로 정확도 향상
- 이미지 전처리를 통한 OCR 정확도 개선
- 전문적인 PDF 레이아웃 자동 생성

---

## 📝 라이선스

이 프로젝트는 내부 사용 목적으로 개발되었습니다.

---

## 📧 문의

프로젝트 관련 문의사항이 있으시면 이슈를 등록해주세요.

